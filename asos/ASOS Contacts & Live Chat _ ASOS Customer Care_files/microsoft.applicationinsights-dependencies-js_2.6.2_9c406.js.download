(window.sharedJsonP=window.sharedJsonP||[]).push([["microsoft.applicationinsights-dependencies-js|2.6.2|9c406"],{"394b1":function(e,t,r){"use strict";r.r(t),r.d(t,"Traceparent",(function(){return n}));var a=r("176b3"),n=function(){function e(t,r){this.traceFlag=e.DEFAULT_TRACE_FLAG,this.version=e.DEFAULT_VERSION,t&&e.isValidTraceId(t)?this.traceId=t:this.traceId=Object(a.generateW3CId)(),r&&e.isValidSpanId(r)?this.spanId=r:this.spanId=Object(a.generateW3CId)().substr(0,16)}return e.isValidTraceId=function(e){return e.match(/^[0-9a-f]{32}$/)&&"00000000000000000000000000000000"!==e},e.isValidSpanId=function(e){return e.match(/^[0-9a-f]{16}$/)&&"0000000000000000"!==e},e.prototype.toString=function(){return this.version+"-"+this.traceId+"-"+this.spanId+"-"+this.traceFlag},e.DEFAULT_TRACE_FLAG="01",e.DEFAULT_VERSION="00",e}()},"6b9b5":function(e,t,r){"use strict";r.r(t),r.d(t,"XHRMonitoringState",(function(){return p})),r.d(t,"ajaxRecord",(function(){return f}));var a=r("08cd5"),n=r("4ca75"),i=r("70a79"),s=r("e86f4"),o=r("45103"),d=r("6a33a");function c(e,t,r){var n=0,i=e[t],s=e[r];return i&&s&&(n=Object(a.dateTimeUtilsDuration)(i,s)),n}function u(e,t,r,a,i){var s=0,o=c(r,a,i);return o&&(s=l(e,t,Object(n.msToTimeSpan)(o))),s}function l(e,t,r){var a=0;e&&t&&r&&((e.ajaxPerf=e.ajaxPerf||{})[t]=r,a=1);return a}var p=function(){this.openDone=!1,this.setRequestHeaderDone=!1,this.sendDone=!1,this.abortDone=!1,this.stateChangeAttached=!1},f=function e(t,r,n){var f=n;this.perfMark=null,this.completed=!1,this.requestHeadersSize=null,this.requestHeaders=null,this.responseReceivingDuration=null,this.callbackDuration=null,this.ajaxTotalDuration=null,this.aborted=0,this.pageUrl=null,this.requestUrl=null,this.requestSize=0,this.method=null,this.status=null,this.requestSentTime=null,this.responseStartedTime=null,this.responseFinishedTime=null,this.callbackFinishedTime=null,this.endTime=null,this.xhrMonitoringState=new p,this.clientFailure=0,this.traceID=t,this.spanID=r,Object(d.default)(e,this,(function(e){e.getAbsoluteUrl=function(){return e.requestUrl?Object(i.urlGetAbsoluteUrl)(e.requestUrl):null},e.getPathName=function(){return e.requestUrl?s.DataSanitizer.sanitizeUrl(f,Object(i.urlGetCompleteUrl)(e.method,e.requestUrl)):null},e.CreateTrackItem=function(t,r,n){if(e.ajaxTotalDuration=Math.round(1e3*Object(a.dateTimeUtilsDuration)(e.requestSentTime,e.responseFinishedTime))/1e3,e.ajaxTotalDuration<0)return null;var i,s=((i={id:"|"+e.traceID+"."+e.spanID,target:e.getAbsoluteUrl(),name:e.getPathName(),type:t,startTime:null,duration:e.ajaxTotalDuration,success:+e.status>=200&&+e.status<400,responseCode:+e.status,method:e.method}).properties={HttpMethod:e.method},i);if(e.requestSentTime&&(s.startTime=new Date,s.startTime.setTime(e.requestSentTime)),function(e,t){var r=e.perfTiming,a=t.properties||{},n=0,i="redirect",s=i+"Start",d=i="End";if(r){n|=u(a,i,r,s,d),n|=u(a,"domainLookup",r,"domainLookupStart","domainLookupEnd"),n|=u(a,"connect",r,"connectStart","connectEnd"),n|=u(a,"request",r,"requestStart","requestEnd"),n|=u(a,"response",r,"responseStart","responseEnd"),n|=u(a,"networkConnect",r,"startTime","connectEnd"),n|=u(a,"sentRequest",r,"requestStart","responseEnd");var p=r.duration;p||(p=c(r,"startTime","responseEnd")||0),n|=l(a,"duration",p),n|=l(a,"perfTotal",p);var f=r.serverTiming;if(f){var h={};Object(o.arrForEach)(f,(function(e,t){var r=Object(o.normalizeJsName)(e.name||""+t),a=h[r]||{};Object(o.objForEachKey)(e,(function(e,t){("name"!==e&&Object(o.isString)(t)||Object(o.isNumber)(t))&&(a[e]&&(t=a[e]+";"+t),!t&&Object(o.isString)(t)||(a[e]=t))})),h[r]=a})),n|=l(a,"serverTiming",h)}n|=l(a,"transferSize",r.transferSize),n|=l(a,"encodedBodySize",r.encodedBodySize),n|=l(a,"decodedBodySize",r.decodedBodySize)}else e.perfMark&&(n|=l(a,"missing",e.perfAttempts));n&&(t.properties=a)}(e,s),r&&Object(o.objKeys)(e.requestHeaders).length>0&&(s.properties=s.properties||{},s.properties.requestHeaders=e.requestHeaders),n){var d=n();if(d){var p=d.correlationContext;if(p&&(s.correlationContext=p),d.headerMap&&Object(o.objKeys)(d.headerMap).length>0&&(s.properties=s.properties||{},s.properties.responseHeaders=d.headerMap),e.status>=400){var f=d.type;s.properties=s.properties||{},""!==f&&"text"!==f||(s.properties.responseText=d.responseText?d.statusText+" - "+d.responseText:d.statusText),"json"===f&&(s.properties.responseText=d.response?d.statusText+" - "+JSON.stringify(d.response):d.statusText)}}}return s}}))}},ae361:function(e,t,r){"use strict";r.r(t),r.d(t,"AjaxMonitor",(function(){return y}));var a=r("0ad99"),n=r("b767d"),i=r("eb227"),s=r("08cd5"),o=r("c7438"),d=r("cba06"),c=r("aa942"),u=r("2b805"),l=r("bede9"),p=r("45103"),f=r("3fc02"),h=r("c78ff"),b=r("9dd01"),g=r("e9ded"),m=r("176b3"),j=r("04b42"),x=r("6b9b5"),T=r("394b1"),q=r("6a33a"),I=0;function H(e){var t="";try{Object(p.isNullOrUndefined)(e)||Object(p.isNullOrUndefined)(e.ajaxData)||Object(p.isNullOrUndefined)(e.ajaxData.requestUrl)||(t+="(url: '"+e.ajaxData.requestUrl+"')")}catch(e){}return t}function O(e,t,r,a,n){e.diagLog().throwInternal(b.LoggingSeverity.CRITICAL,t,r,a,n)}function D(e,t,r,a,n){e.diagLog().throwInternal(b.LoggingSeverity.WARNING,t,r,a,n)}function v(e,t,r){return function(a){O(e,t,r,{ajaxDiagnosticsMessage:H(a.inst),exception:Object(h.dumpObj)(a.err)})}}function M(e,t){return e&&t?e.indexOf(t):-1}var y=function(e){function t(){var r=e.call(this)||this;r.identifier=t.identifier,r.priority=120;var a,j,y,C,R=Object(h.getLocation)(),A=!1,F=!1,S=R&&R.host&&R.host.toLowerCase(),U=t.getEmptyConfig(),k=!1,L=0,w=!1,E=0,N=!1,P=[],_={};return Object(q.default)(t,r,(function(e,r){function q(e,t,r){P.push(Object(g.InstrumentProto)(e,t,r))}function R(e,t,r){var a=!1,n=((Object(p.isString)(t)?t:(t||{}).url||"")||"").toLowerCase(),i=M(n,"?"),s=M(n,"#");return(-1===i||-1!==s&&s<i)&&(i=s),-1!==i&&(n=n.substring(0,i)),Object(p.isNullOrUndefined)(e)?Object(p.isNullOrUndefined)(t)||(a="object"==typeof t&&!0===t[u.DisabledPropertyName]||!!r&&!0===r[u.DisabledPropertyName]):a=!0===e[u.DisabledPropertyName]||!0===n[u.DisabledPropertyName],a?_[n]||(_[n]=1):_[n]&&(a=!0),a}function X(e,t){var r=!0,a=F;return Object(p.isNullOrUndefined)(e)||(r=!0===t||!Object(p.isNullOrUndefined)(e.ajaxData)),a&&r}function z(e){try{var t=e.responseType;if(""===t||"text"===t)return e.responseText}catch(e){}return null}function W(t){try{var r=t.getAllResponseHeaders();if(null!==r)if(-1!==M(r.toLowerCase(),o.RequestHeaders.requestContextHeaderLowerCase)){var a=t.getResponseHeader(o.RequestHeaders.requestContextHeader);return s.CorrelationIdHelper.getCorrelationContext(a)}}catch(r){D(e,b._InternalMessageId.FailedMonitorAjaxGetCorrelationHeader,"Failed to get Request-Context correlation header as it may be not included in the response or not accessible.",{ajaxDiagnosticsMessage:H(t),exception:Object(h.dumpObj)(r)})}}function V(e,t){if(t.requestUrl&&C&&w){var r=Object(h.getPerformance)();if(r&&Object(p.isFunction)(r.mark)){I++;var a=C+e+"#"+I;r.mark(a);var n=r.getEntriesByName(a);n&&1===n.length&&(t.perfMark=n[0])}}}function G(e,t,r,a){var n=t.perfMark,i=Object(h.getPerformance)(),s=U.maxAjaxPerfLookupAttempts,o=U.ajaxPerfLookupDelay,d=t.requestUrl,c=0;!function u(){try{if(i&&n){c++;for(var l=null,f=i.getEntries(),h=f.length-1;h>=0;h--){var b=f[h];if(b){if("resource"===b.entryType)b.initiatorType!==e||-1===M(b.name,d)&&-1===M(d,b.name)||(l=b);else if("mark"===b.entryType&&b.name===n.name){t.perfTiming=l;break}if(b.startTime<n.startTime-1e3)break}}}!n||t.perfTiming||c>=s||!1===t.async?(n&&Object(p.isFunction)(i.clearMarks)&&i.clearMarks(n.name),t.perfAttempts=c,r()):setTimeout(u,o)}catch(e){a(e)}}()}function B(t){var r="";try{Object(p.isNullOrUndefined)(t)||(r+="string"==typeof t?"(url: '"+t+"')":"(url: '"+t.url+"')")}catch(t){O(e,b._InternalMessageId.FailedMonitorAjaxOpen,"Failed to grab failed fetch diagnostics message",{exception:Object(h.dumpObj)(t)})}return r}function K(t,r,a,n,i,o){function d(t,r,n){var i=n||{};i.fetchDiagnosticsMessage=B(a),r&&(i.exception=Object(h.dumpObj)(r)),D(e,t,"Failed to calculate the duration of the fetch call, monitoring data for this fetch call won't be sent.",i)}n&&(n.responseFinishedTime=Object(s.dateTimeUtilsNow)(),n.status=r,G("fetch",n,(function(){var t=n.CreateTrackItem("Fetch",k,i);t?e.trackDependencyDataInternal(t):d(b._InternalMessageId.FailedMonitorAjaxDur,null,{requestSentTime:n.requestSentTime,responseFinishedTime:n.responseFinishedTime})}),(function(e){d(b._InternalMessageId.FailedMonitorAjaxGetCorrelationHeader,e,null)})))}function J(t){if(t&&t.headers)try{var r=t.headers.get(o.RequestHeaders.requestContextHeader);return s.CorrelationIdHelper.getCorrelationContext(r)}catch(r){D(e,b._InternalMessageId.FailedMonitorAjaxGetCorrelationHeader,"Failed to get Request-Context correlation header as it may be not included in the response or not accessible.",{fetchDiagnosticsMessage:B(t),exception:Object(h.dumpObj)(r)})}}e.initialize=function(o,d,c,u){if(!e.isInitialized()){r.initialize(o,d,c,u);var T=e._getTelCtx(),I=t.getDefaultConfig();Object(p.objForEachKey)(I,(function(e,r){U[e]=T.getConfig(t.identifier,e,r)}));var S=U.distributedTracingMode;if(k=U.enableRequestHeaderTracking,w=U.enableAjaxPerfTracking,E=U.maxAjaxCallsPerView,N=U.enableResponseHeaderTracking,y=S===n.DistributedTracingModes.AI||S===n.DistributedTracingModes.AI_AND_W3C,j=S===n.DistributedTracingModes.AI_AND_W3C||S===n.DistributedTracingModes.W3C,w){var L=o.instrumentationKey||"unkwn";C=L.length>5?"ai.ajxmn."+L.substring(L.length-5)+".":"ai.ajxmn."+L+"."}if(!1===U.disableAjaxTracking&&function(e){var t=!1;if(typeof XMLHttpRequest!==f.strShimUndefined&&!Object(p.isNullOrUndefined)(XMLHttpRequest)){var r=XMLHttpRequest[f.strShimPrototype];t=!(Object(p.isNullOrUndefined)(r)||Object(p.isNullOrUndefined)(r.open)||Object(p.isNullOrUndefined)(r.send)||Object(p.isNullOrUndefined)(r.abort))}var a=Object(h.getIEVersion)();if(a&&a<9&&(t=!1),t)try{(new XMLHttpRequest).ajaxData={};var n=XMLHttpRequest[f.strShimPrototype].open;XMLHttpRequest[f.strShimPrototype].open=n}catch(r){t=!1,O(e,b._InternalMessageId.FailedMonitorAjaxOpen,"Failed to enable XMLHttpRequest monitoring, extension is not supported",{exception:Object(h.dumpObj)(r)})}return t}(e)&&!F&&(q(XMLHttpRequest,"open",{req:function(t,r,n,i){var o=t.inst,d=o.ajaxData;R(o,n)||!X(o,!0)||d&&d.xhrMonitoringState.openDone||function(t,r,n,i){var o=a&&a.telemetryTrace&&a.telemetryTrace.traceID||Object(m.generateW3CId)(),d=Object(m.generateW3CId)().substr(0,16),c=new x.ajaxRecord(o,d,e.diagLog());c.method=r,c.requestUrl=n,c.xhrMonitoringState.openDone=!0,c.requestHeaders={},c.async=i,t.ajaxData=c,function(t){t.ajaxData.xhrMonitoringState.stateChangeAttached=m.EventHelper.Attach(t,"readystatechange",(function(){try{t&&4===t.readyState&&X(t)&&function(t){var r=t.ajaxData;function a(r,a){var n=a||{};n.ajaxDiagnosticsMessage=H(t),r&&(n.exception=Object(h.dumpObj)(r)),D(e,b._InternalMessageId.FailedMonitorAjaxDur,"Failed to calculate the duration of the ajax call, monitoring data for this ajax call won't be sent.",n)}r.responseFinishedTime=Object(s.dateTimeUtilsNow)(),r.status=t.status,G("xmlhttprequest",r,(function(){try{var n=r.CreateTrackItem("Ajax",k,(function(){var e={statusText:t.statusText,headerMap:null,correlationContext:W(t),type:t.responseType,responseText:z(t),response:t.response};if(N){var r=t.getAllResponseHeaders();if(r){var a=Object(p.strTrim)(r).split(/[\r\n]+/),n={};Object(p.arrForEach)(a,(function(e){var t=e.split(": "),r=t.shift(),a=t.join(": ");n[r]=a})),e.headerMap=n}}return e}));n?e.trackDependencyDataInternal(n):a(null,{requestSentTime:r.requestSentTime,responseFinishedTime:r.responseFinishedTime})}finally{try{t.ajaxData=null}catch(e){}}}),(function(e){a(e,null)}))}(t)}catch(a){var r=Object(h.dumpObj)(a);r&&-1!==M(r.toLowerCase(),"c00c023f")||O(e,b._InternalMessageId.FailedMonitorAjaxRSC,"Failed to monitor XMLHttpRequest 'readystatechange' event handler, monitoring data for this ajax call may be incorrect.",{ajaxDiagnosticsMessage:H(t),exception:r})}}))}(t)}(o,r,n,i)},hkErr:v(e,b._InternalMessageId.FailedMonitorAjaxOpen,"Failed to monitor XMLHttpRequest.open, monitoring data for this ajax call may be incorrect.")}),q(XMLHttpRequest,"send",{req:function(t,r){var a=t.inst,n=a.ajaxData;X(a)&&!n.xhrMonitoringState.sendDone&&(V("xhr",n),n.requestSentTime=Object(s.dateTimeUtilsNow)(),a=e.includeCorrelationHeaders(n,void 0,void 0,a),n.xhrMonitoringState.sendDone=!0)},hkErr:v(e,b._InternalMessageId.FailedMonitorAjaxSend,"Failed to monitor XMLHttpRequest, monitoring data for this ajax call may be incorrect.")}),q(XMLHttpRequest,"abort",{req:function(e){var t=e.inst,r=t.ajaxData;X(t)&&!r.xhrMonitoringState.abortDone&&(r.aborted=1,r.xhrMonitoringState.abortDone=!0)},hkErr:v(e,b._InternalMessageId.FailedMonitorAjaxAbort,"Failed to monitor XMLHttpRequest.abort, monitoring data for this ajax call may be incorrect.")}),k&&q(XMLHttpRequest,"setRequestHeader",{req:function(e,t,r){var a=e.inst;X(a)&&(a.ajaxData.requestHeaders[t]=r)},hkErr:v(e,b._InternalMessageId.FailedMonitorAjaxSetRequestHeader,"Failed to monitor XMLHttpRequest.setRequestHeader, monitoring data for this ajax call may be incorrect.")}),F=!0),function(){var t=(r=Object(l.getGlobal)(),!r||Object(p.isNullOrUndefined)(r.Request)||Object(p.isNullOrUndefined)(r.Request[f.strShimPrototype])||Object(p.isNullOrUndefined)(r.fetch)?null:r.fetch);var r;if(!t)return;var n=Object(l.getGlobal)(),i=t.polyfill;!1===U.disableFetchTracking?(P.push(Object(g.InstrumentFunc)(n,"fetch",{req:function(t,r,n){var o;if(A&&!R(null,r,n)&&(!i||!F)){var d=t.ctx();o=function(t,r){var n=a&&a.telemetryTrace&&a.telemetryTrace.traceID||Object(m.generateW3CId)(),i=Object(m.generateW3CId)().substr(0,16),o=new x.ajaxRecord(n,i,e.diagLog());o.requestSentTime=Object(s.dateTimeUtilsNow)(),t instanceof Request?o.requestUrl=t?t.url:"":o.requestUrl=t;var d="GET";r&&r.method?d=r.method:t&&t instanceof Request&&(d=t.method);o.method=d;var c={};if(k){new Headers((r?r.headers:0)||t instanceof Request&&t.headers||{}).forEach((function(e,t){c[t]=e}))}return o.requestHeaders=c,V("fetch",o),o}(r,n);var c=e.includeCorrelationHeaders(o,r,n);c!==n&&t.set(1,c),d.data=o}},rsp:function(e,t){var r=e.ctx().data;r&&(e.rslt=e.rslt.then((function(t){return K(e,(t||{}).status,t,r,(function(){var e={statusText:t.statusText,headerMap:null,correlationContext:J(t)};if(N){var r={};t.headers.forEach((function(e,t){r[t]=e})),e.headerMap=r}return e})),t})).catch((function(a){throw K(e,0,t,r,null,{error:a.message}),a})))},hkErr:v(e,b._InternalMessageId.FailedMonitorAjaxOpen,"Failed to monitor Window.fetch, monitoring data for this fetch call may be incorrect.")})),A=!0):i&&P.push(Object(g.InstrumentFunc)(n,"fetch",{req:function(e,t,r){R(null,t,r)}}));i&&(n.fetch.polyfill=i)}(),c.length>0&&c){for(var _=void 0,B=0;!_&&B<c.length;)c[B]&&c[B].identifier===i.PropertiesPluginIdentifier&&(_=c[B]),B++;_&&(a=_.context)}}},e.teardown=function(){Object(p.arrForEach)(P,(function(e){e.rm()})),P=[],A=!1,F=!1,e.setInitialized(!1)},e.trackDependencyData=function(t,r){e.trackDependencyDataInternal(t,r)},e.includeCorrelationHeaders=function(t,r,n,i){var d=e._currentWindowHost||S;if(r){if(s.CorrelationIdHelper.canIncludeCorrelationHeader(U,t.getAbsoluteUrl(),d)){if(n||(n={}),n.headers=new Headers(n.headers||r instanceof Request&&r.headers||{}),y){var c="|"+t.traceID+"."+t.spanID;n.headers.set(o.RequestHeaders.requestIdHeader,c),k&&(t.requestHeaders[o.RequestHeaders.requestIdHeader]=c)}if((l=U.appId||a&&a.appId())&&(n.headers.set(o.RequestHeaders.requestContextHeader,o.RequestHeaders.requestContextAppIdFormat+l),k&&(t.requestHeaders[o.RequestHeaders.requestContextHeader]=o.RequestHeaders.requestContextAppIdFormat+l)),j){var u=new T.Traceparent(t.traceID,t.spanID);n.headers.set(o.RequestHeaders.traceParentHeader,u.toString()),k&&(t.requestHeaders[o.RequestHeaders.traceParentHeader]=u.toString())}}return n}if(i){if(s.CorrelationIdHelper.canIncludeCorrelationHeader(U,t.getAbsoluteUrl(),d)){if(y){c="|"+t.traceID+"."+t.spanID;i.setRequestHeader(o.RequestHeaders.requestIdHeader,c),k&&(t.requestHeaders[o.RequestHeaders.requestIdHeader]=c)}var l;if((l=U.appId||a&&a.appId())&&(i.setRequestHeader(o.RequestHeaders.requestContextHeader,o.RequestHeaders.requestContextAppIdFormat+l),k&&(t.requestHeaders[o.RequestHeaders.requestContextHeader]=o.RequestHeaders.requestContextAppIdFormat+l)),j){u=new T.Traceparent(t.traceID,t.spanID);i.setRequestHeader(o.RequestHeaders.traceParentHeader,u.toString()),k&&(t.requestHeaders[o.RequestHeaders.traceParentHeader]=u.toString())}}return i}},e.trackDependencyDataInternal=function(t,r,a){if(-1===E||L<E){U.distributedTracingMode!==n.DistributedTracingModes.W3C&&U.distributedTracingMode!==n.DistributedTracingModes.AI_AND_W3C||"string"!=typeof t.id||"."===t.id[t.id.length-1]||(t.id+="."),Object(p.isNullOrUndefined)(t.startTime)&&(t.startTime=new Date);var i=d.TelemetryItemCreator.create(t,c.RemoteDependencyData.dataType,c.RemoteDependencyData.envelopeType,e.diagLog(),r,a);e.core.track(i)}else L===E&&O(e,b._InternalMessageId.MaxAjaxPerPVExceeded,"Maximum ajax per page view limit reached, ajax monitoring is paused until the next trackPageView(). In order to increase the limit set the maxAjaxCallsPerView configuration parameter.",!0);++L}})),r}return Object(a.__extendsFn)(t,e),t.getDefaultConfig=function(){return{maxAjaxCallsPerView:500,disableAjaxTracking:!1,disableFetchTracking:!0,disableCorrelationHeaders:!1,distributedTracingMode:n.DistributedTracingModes.AI_AND_W3C,correlationHeaderExcludedDomains:["*.blob.core.windows.net","*.blob.core.chinacloudapi.cn","*.blob.core.cloudapi.de","*.blob.core.usgovcloudapi.net"],correlationHeaderDomains:void 0,correlationHeaderExcludePatterns:void 0,appId:void 0,enableCorsCorrelation:!1,enableRequestHeaderTracking:!1,enableResponseHeaderTracking:!1,enableAjaxErrorStatusText:!1,enableAjaxPerfTracking:!1,maxAjaxPerfLookupAttempts:3,ajaxPerfLookupDelay:25}},t.getEmptyConfig=function(){var e=this.getDefaultConfig();return Object(p.objForEachKey)(e,(function(t){e[t]=void 0})),e},t.prototype.processTelemetry=function(e,t){this.processNext(e,t)},t.identifier="AjaxDependencyPlugin",t}(j.BaseTelemetryPlugin)}}]);
//# sourceMappingURL=microsoft.applicationinsights-dependencies-js~2.6.2~9c406.js.map